<div class="bon_profile_wrap container" data-ng-show="widget.enabled" data-ng-cloak>

  <div class="bon_profile_info" data-sailplay-profile data-sailplay-gifts>

    <div class="bon_profile_top_left">
      <h3 class="bon_header">
        <span class="header">{{ widget.texts.header }}</span>
      </h3>
      <h4 class="bon_sub_header">
        <span class="caption">{{ widget.texts.spoiler }}</span>
      </h4>
      <div data-ng-if="!isMobile()" class="bps_right progress_block clearfix">
        <div class="clearfix container">

          <div class="status-list">

            <div class="next_status_info" data-ng-show="get_next_status().status">
<!--
              <div class="next_status_name">
                {{ widget.texts.next_status }} <span data-ng-style="{ color: get_next_status().status.color  }">{{ get_next_status().status.status }}</span>
              </div>
-->
              <div>
                Осталось               
              </div>
              <div class="next_status_offset">
                 {{ get_next_status().offset + ' баллов'}}
              </div>

            </div>

            <div class="status-list__wrapper" data-sailplay-statuses data-ng-cloak>

              <div class="status-list__progress element-progress progress_line"
                   data-ng-style="getProgress(purchase_status ? user().purchases.sum : user().user_points, _statuses)"></div>

              <div class="status-list__item element-item"
                   data-ng-class="{ type_active : item.points <= user().user_points.confirmed + user().user_points.spent + user().user_points.spent_extra }"
                   data-ng-repeat="item in _statuses"
                   data-ng-style="generateOffset($index, _statuses)">

                <div class="status-list__item-point element-item-point"></div>

                <div class="element-item-point-inner" data-ng-style="{ backgroundColor: item.color }"></div>

                <div class="status-list__item-name element-item-name" data-ng-bind="item.name"></div>
                <div class="status-list__item-status element-item-status" data-ng-if="item.status" data-ng-bind="item.status"
                     style="{{ (item.color) ? ('color: ' +  item.color) : '' }}"></div>

              </div>

            </div>

          </div>
        </div>
      </div>
    </div>

    

    <div class="bon_profile_top clearfix">
      <div class="bon_profile_right clearfix" data-ng-if="user()">
        <div class="avatar_container">
          <div class="user_avatar">
            <img class="user_avatar_image" data-ng-src="{{ (user().user.pic | sailplay_pic) || default_avatar}}" alt="You">
            <div class="user_avatar_profile_btn_container" data-ng-click="$event.preventDefault(); profile.fill_profile(true);">
              <img class="user_avatar_profile_btn" src="https://sailplays3.cdnvideo.ru/media/assets/assetfile/67eac019ec6671a75b4141492cfe0769.png">
            </div>
          </div>
          <div class="controls_container">
            <a href="#" class="edit_profile_btn button_link" data-ng-click="$event.preventDefault(); profile.fill_profile(true);">{{ widget.texts.edit_profile_button }}</a>
            <a href="#" class="logout_btn button_link" data-ng-click="$event.preventDefault(); logout();">{{ widget.texts.logout }}</a>
          </div>
        </div>
        <div class="user_info">
          <span class="user_name"  data-ng-bind="user().user.first_name || widget.texts.name_not_defined"></span>
          <br>
          <span class="user_name"  data-ng-bind="user().user.last_name || widget.texts.name_not_defined"></span>
          <br>
          <span class="user_status" data-ng-bind="'Ваша скидка: ' + current_status.status"></span>
          <br>
          <span class="user_phone" data-ng-if="user().user.phone"  data-ng-bind="'+' + (user().user.phone | tel)"></span>
          <span class="user_email" data-ng-if="user().user.email"  data-ng-bind="user().user.email"></span>
        </div>
      </div>
      <div class="bon_profile_right clearfix" data-ng-if="!user()">
        <button type="button" class="sp_btn button_primary login_reg_btn" data-ng-click="$event.preventDefault(); login('remote');">{{ widget.texts.login_reg }}</button>
      </div>
      <div class="bon_profile_stat" data-ng-click="$event.preventDefault(); profile.history = true;">
        <div class="bps_left points_block clearfix" data-ng-if="user()">
          <span class="points_confirmed">
            <span class="points_confirmed_value" data-ng-bind="user().user_points.confirmed | number"></span>
            <span class="points_confirmed_name" data-ng-bind="user().user_points.confirmed | sailplay_pluralize: ('points.texts.pluralize' | tools)"></span>
          </span>
          <br>
          <span class="points_label">{{ widget.texts.history_button }}</span>
        </div>
      </div>
    </div>

    <!-- status -->

    <div data-ng-if="isMobile()" class="bps_right progress_block clearfix progres_xs">
      <div class="clearfix container">

        <div class="status-list">

          <div class="next_status_info" data-ng-show="get_next_status().status">
<!--
            <div class="next_status_name">
              {{ widget.texts.next_status }} <span data-ng-style="{ color: get_next_status().status.color  }">{{ get_next_status().status.status }}</span>
            </div>
-->
            <div>
              Осталось               
            </div>
            <div class="next_status_offset">
               {{ get_next_status().offset + ' баллов'}}
            </div>

          </div>

          <div class="status-list__wrapper" data-sailplay-statuses data-ng-cloak>

            <div class="status-list__progress element-progress progress_line"
                 data-ng-style="getProgress(purchase_status ? user().purchases.sum : user().user_points, _statuses)"></div>

            <div class="status-list__item element-item"
                 data-ng-class="{ type_active : item.points <= user().user_points.confirmed + user().user_points.spent + user().user_points.spent_extra }"
                 data-ng-repeat="item in _statuses"
                 data-ng-style="generateOffset($index, _statuses)">

              <div class="status-list__item-point element-item-point"></div>

              <div class="element-item-point-inner" data-ng-style="{ backgroundColor: item.color }"></div>

              <div class="status-list__item-name element-item-name" data-ng-bind="item.name"></div>
              <div class="status-list__item-status element-item-status" data-ng-if="item.status" data-ng-bind="item.status"
                   style="{{ (item.color) ? ('color: ' +  item.color) : '' }}"></div>

            </div>

          </div>

        </div>
      </div>
    </div>

    
  </div>

  <magic-modal class="bns_overlay_hist" data-show="profile.history">

    <div data-sailplay-history data-sailplay-profile>

      <h3>
        <span class="modal_history_header">{{ widget.texts.history.header }}</span>
        <!--<b>У вас {{ user().user_points.confirmed + ' ' + (user().user_points.confirmed | sailplay_pluralize:_tools.points.texts.pluralize) }}</b>-->
      </h3>
      <h4 class="modal_history_caption">{{ widget.texts.history.caption }}</h4>
      <div class="clearfix"></div>
      <div class="history_container">
        <div class="history_entry" data-dir-paginate="item in history() | itemsPerPage:5" data-pagination-id="history_pages">
          <div>
            <span class="modal_history_name" data-ng-bind="item | get_bonus_name"></span>
            <span class="modal_history_date" data-ng-bind="item.action_date | date:'d.MM.yyyy'"></span>
          </div>
          <div>
            <span class="modal_history_content_container" data-ng-if="item.action=='purchase'" data-ng-click="getHistoryPurchases(item.id)" data-ng-class="{open: item.open}">
              <span class="modal_history_content_header" data-ng-click="item.open = !item.open">{{item.open ? 'Скрыть &#60;' : 'Показать товары &#62;' }}</span>
              <ul class="modal_history_content">
                <li data-ng-repeat="entry in purchases[item.id]">{{ entry.name }}</li>
              </ul>
            </span>
          </div>
          <div>
            <span class="modal_history_points" data-ng-if="item.points_delta" data-ng-bind="((item.points_delta|number) || 0) + ' ' + (item.points_delta | sailplay_pluralize:('points.texts.pluralize' | tools))"></span>
            <span class="modal_history_price" data-ng-if="item.price" data-ng-bind="(item.price) + 'р'"></span>
          </div>
        </div>
      </div>

      <div class="modal_history_controls_container">
        <dir-pagination-controls data-max-size="5" data-pagination-id="history_pages"
                                 data-template-url="profile.history_pagination"
                                 data-auto-hide="true"></dir-pagination-controls>
        <button type="submit" class="sp_btn button_primary modal_history_close" data-ng-click="preventDefault(); $parent.$parent.close()">{{ 'buttons.texts.close' | tools }}</button>
      </div>
    </div>




  </magic-modal>

  <!--profile edit section-->
  <magic-modal class="fill_profile_modal" data-show="profile.show_fill_profile">

    <div class="mb_popup mb_popup_prof" data-sailplay-fill-profile data-config="widget.fill_profile.config">

      <div class="mb_popup_top">
        <span class="modal_profile_header">{{ widget.fill_profile.header }}</span>
      </div>

      <form name="fill_profile_form" class="mb_popup_main mb_popup_main_mt" data-ng-submit="sailplay.fill_profile.submit(fill_profile_form, profile.fill_profile);">

        <div class="form_field" data-ng-repeat="field in sailplay.fill_profile.form.fields" data-ng-switch="field.input">

          <div data-ng-switch-when="image" class="avatar_upload clearfix">
            <img width="160px" data-ng-src="{{ (field.value | sailplay_pic) || 'http://saike.ru/sailplay-magic/dist/img/profile/avatar_default.png'}}" alt="">
          </div>

          <div data-ng-switch-when="text" class="clearfix">
            <label class="form_label">{{ field.label }}</label>
            <input class="form_input" type="text" placeholder="{{ field.placeholder }}" data-ng-model="field.value">
          </div>

          <div data-ng-switch-when="date" class="clearfix">
            <label class="form_label">{{ field.label }}</label>
            <date-picker data-model="field.value"></date-picker>
          </div>

          <div data-ng-switch-when="select" class="clearfix">
            <label class="form_label">{{ field.label }}</label>
            <div class="magic_select form_input">
              <select data-ng-model="field.value" data-ng-options="item.value as item.text for item in field.data"></select>
            </div>
          </div>

          <div data-ng-switch-when="phone" class="clearfix">
            <label class="form_label">{{ field.label }}</label>
            <input class="form_input" type="text" data-model-view-value="true" data-ui-mask="{{ field.placeholder }}" data-ng-model="field.value" data-ng-disabled="field.disabled">
          </div>

          <div data-ng-switch-when="email" class="clearfix">
            <label class="form_label">{{ field.label }}</label>
            <input class="form_input" type="email" placeholder="{{ field.placeholder }}" data-ng-model="field.value" data-ng-disabled="field.disabled">
          </div>

          <div data-ng-switch-when="checkbox-tag" class="bns_radio_block bns_zi2">
            <label class="form_label">{{ field.label }}</label>
            <div class="form_input">
              <div class="bns_radio_item" data-ng-repeat="item in field.data">
                  <input value="{{item.tag}}" data-ng-model="item.value" id="{{'field_' + field.name + '_' + item.tag}}" type="checkbox">
                  <label for="{{'field_' + field.name + '_' + item.tag}}">{{ item.text }}</label>
              </div>
            </div>
          </div>

        </div>

        <div class="answ_text">
          <button type="submit" class="sp_btn button_primary">{{ 'buttons.texts.save' | tools }}</button>
        </div>
      </form>
    </div>
  </magic-modal>

</div>