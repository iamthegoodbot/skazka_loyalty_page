<div class="bon_profile_wrap container" data-ng-show="widget.enabled" data-ng-cloak>
    <div class="bon_profile_info" data-sailplay-profile data-sailplay-gifts>
        <div class="sp_profile">
            <div class="sp_profile_left">
                <div class="sp_profile_left_top">
                    <div class="sp_avatar_wrapper">
                        <img class="sp_avatar" data-ng-src="{{ (user().user.pic | sailplay_pic) || default_avatar}}" alt="You">
                        <div class="logout_btn button_link" data-ng-if="user()" data-ng-click="$event.preventDefault(); logout();">{{ widget.texts.logout }}</div>
                    </div>
                    <div class="sp_header_wrapper">
                        <div class="sp_top_header">
                            <span class="sp_top_name" data-ng-bind="user().user.name.split(' ')[0] ? user().user.name.split(' ')[0] + ',': widget.texts.name_not_defined"></span>
                            <span class="sp_top_text">{{ widget.texts.header_top }}</span>
                        </div>
                        <span class="sp_header">{{ widget.texts.header }}</span>
                        <span class="sp_spoiler" data-ng-bind-html="widget.texts.spoiler | to_trusted"></span>
                    </div>
                </div>
                <div class="sp_profile_left_bottom">
                    <div class="sp_edit_profile_cta" data-ng-if="user()" data-ng-bind-html="widget.texts.edit_profile_cta | to_trusted"></div>
                    <div class="sp_edit_profile_cta" data-ng-if="!user()" data-ng-bind-html="widget.texts.login_cta | to_trusted"></div>
                    <div class="sp_edit_profile_arrows"></div>
                    <div class="sp_edit_profile" data-ng-if="user()" data-ng-click="$event.preventDefault(); profile.fill_profile(true);">{{ widget.texts.edit_profile_button }}</div>
                    <div class="sp_edit_profile" data-ng-if="!user()" data-ng-click="$event.preventDefault(); login('remote', {widget: 'profile', element: 'profile_login_button'});">{{ widget.texts.login }}</div>
                </div>
            </div>
            <div class="sp_profile_right">
                <div class="sp_points_wrapper">
                    <span class="sp_points" data-ng-bind="user().user_points.confirmed || 0 | number"></span>
                    <span class="sp_points_name" data-ng-bind="user().user_points.confirmed | sailplay_pluralize: ('points.texts.pluralize' | tools)"></span>
                </div>
                <span class="sp_history_button" data-ng-if="user()" data-ng-click="$event.preventDefault(); profile.history = true;">{{ widget.texts.history_button }}</span>
                <span class="sp_history_button" style="margin-top:5px" data-ng-if="user() && show_promocodes" data-ng-click="$event.preventDefault(); profile.promocodes = true;">{{ widget.texts.promocodes_button }}</span>
            </div>
        </div>
    </div>


    <!-- faq section -->
    <magic-modal class="faq_modal" data-show="profile.openFaq">

        <div class="mb_popup mb_popup_prof" data-sailplay-fill-profile data-config="widget.fill_profile.config">

            <div class="mb_popup_top">
                <span class="modal_faq_header">{{ widget.texts.faq.header }}</span>
            </div>

            <div class="mb_popup_text">
                <div class="modal_faq_text" data-ng-bind-html="widget.texts.faq.text | to_trusted"></div>
            </div>

        </div>
    </magic-modal>

    <magic-modal class="bns_overlay_hist" data-show="profile.history">

        <div data-sailplay-history data-sailplay-profile>

            <h3>
                <span class="modal_history_header">{{ widget.texts.history.header }}</span>
                <!--<b>У вас {{ user().user_points.confirmed + ' ' + (user().user_points.confirmed | sailplay_pluralize:_tools.points.texts.pluralize) }}</b>-->
            </h3>
            <h4 class="modal_history_caption">{{ widget.texts.history.caption }}</h4>

            <table class="bns_hist_table">

                <tbody>

                    <tr data-dir-paginate="item in history() | itemsPerPage:10" data-pagination-id="history_pages">
                        <td>
                            <span class="modal_history_date" data-ng-bind="item.action_date | date:'d/MM/yyyy'"></span>
                        </td>
                        <td>
                            <span><b class="modal_history_content" data-ng-bind="item | history_item"></b></span>
                        </td>
                        <td>
                            <span class="modal_history_points" data-ng-if="item.points_delta" data-ng-bind="((item.points_delta|number) || 0) + ' ' + (item.points_delta | sailplay_pluralize:('points.texts.pluralize' | tools))"></span>
                        </td>
                    </tr>

                </tbody>
            </table>

            <dir-pagination-controls data-max-size="7" data-pagination-id="history_pages" data-template-url="profile.history_pagination" data-auto-hide="true"></dir-pagination-controls>
        </div>



    </magic-modal>


    <magic-modal class="bns_overlay_hist" data-show="profile.promocodes">

        <div data-sailplay-history data-sailplay-profile>

            <h3>
                <span class="modal_history_header">{{ widget.texts.promocodes.header }}</span>
                <!--<b>У вас {{ user().user_points.confirmed + ' ' + (user().user_points.confirmed | sailplay_pluralize:_tools.points.texts.pluralize) }}</b>-->
            </h3>
            <h4 class="modal_history_caption">{{ widget.texts.promocodes.caption }}</h4>

            <table class="bns_hist_table">

                <tbody>

                    <tr data-dir-paginate="item in promocodes_status | itemsPerPage:10" data-pagination-id="history_pages">
                        <td>
                            <span class="modal_history_date" data-ng-bind="item[0]"></span>
                        </td>
                        <td>
                            <span class="modal_history_date" data-ng-bind="item[1]"></span>
                        </td>
                    </tr>
                    <tr data-ng-if="!promocodes_status">
                        <td>
                            <span style="font-size:16px">
                                No rewards have been redeemed yet. Redeem a reward in order to access the promo codes list.
                            </span></td>
                    </tr>

                </tbody>
            </table>

            <dir-pagination-controls data-max-size="7" data-pagination-id="history_pages" data-template-url="profile.history_pagination" data-auto-hide="true"></dir-pagination-controls>
        </div>



    </magic-modal>

    <!--profile edit section-->
    <magic-modal class="fill_profile_modal" data-show="profile.show_fill_profile">

        <div class="mb_popup mb_popup_prof" data-sailplay-fill-profile data-config="widget.fill_profile.config">

            <div class="mb_popup_top">
                <span class="modal_profile_header">{{ widget.fill_profile.header }}</span>
            </div>

            <form name="fill_profile_form" class="fill_profile_form mb_popup_main mb_popup_main_mt" data-ng-submit="sailplay.fill_profile.submit(fill_profile_form, profile.fill_profile);">

                <div class="form_field" data-ng-repeat="field in sailplay.fill_profile.form.fields" data-ng-switch="field.input">

                    <div data-ng-switch-when="image" class="avatar_upload clearfix">
                        <img width="160px" data-ng-src="{{ (field.value | sailplay_pic) || 'http://saike.ru/sailplay-magic/dist/img/profile/avatar_default.png'}}" alt="">
                    </div>

                    <div data-ng-switch-when="text" class="clearfix">
                        <label class="form_label">{{ field.label }}</label>
                        <input class="form_input" type="text" placeholder="{{ field.placeholder }}" data-ng-model="field.value" data-ng-required="field.required">
                    </div>

                    <div data-ng-switch-when="date" class="clearfix">
                        <label class="form_label">{{ field.label }}</label>
                        <date-picker class="form_datepicker" data-model="field.value"></date-picker>
                    </div>

                    <div data-ng-switch-when="select" class="clearfix">
                        <label class="form_label">{{ field.label }}</label>
                        <div class="magic_select form_input">
                            <select data-ng-model="field.value" data-ng-options="item.value as item.text for item in field.data" data-ng-required="field.required"></select>
                        </div>
                    </div>

                    <div data-ng-switch-when="phone" class="clearfix">
                        <label class="form_label">{{ field.label }}</label>
                        <input class="form_input" type="text" data-model-view-value="true" data-ui-mask="{{ field.placeholder }}" data-ng-model="field.value" data-ng-required="field.required">
                    </div>

                    <div data-ng-switch-when="email" class="clearfix">
                        <label class="form_label">{{ field.label }}</label>
                        <input class="form_input" type="email" placeholder="{{ field.placeholder }}" data-ng-model="field.value" data-ng-required="field.required">
                    </div>

                </div>

                <div class="answ_text">
                    <button type="submit" class="sp_btn button_primary">{{ 'buttons.texts.save' | tools }}</button>
                </div>
            </form>
        </div>
    </magic-modal>

</div>