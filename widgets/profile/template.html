<section class="container-fluid spm_profile profile clearfix" ng-if="widget.enabled" ng-cloak sailplay-profile
         sailplay-fill-profile config="widget.options.config">

    <div class="container">
        <div class="row align-items-center">
            <div class="col">
                <div class="position-relative d-flex align-items-center b-avatar mb-3">
                    <img ng-src="{{user().user.avatar['250x250']|sailplay_pic}}" class="rounded-circle cursor-pointer" ng-click="$root.$broadcast('info:state', true)">
                    <div class="b-avatar-menu position-relative d-flex align-items-center"
                         ng-class="{type_active: $parent.$parent.menu_active}">
                        <div class="b-avatar-menu__icon rounded-circle d-flex bg-primary cursor-pointer align-items-center"
                             ng-click="$event.stopPropagation();$event.preventDefault();$parent.$parent.menu_active=!$parent.$parent.menu_active">
                            <img class="mw-100 h-50" ng-src="{{widget.images.icon_dots}}">
                        </div>
                        <div class="b-avatar-menu__list position-relative d-flex align-items-left bg-white flex-column">
                            <a href="#" class="b-avatar-menu__item d-flex align-items-center font-weight-light text-dark py-3 pl-4 pr-5"
                               ng-click="$event.stopPropagation();$event.preventDefault();$root.$broadcast('info:state', true);$parent.$parent.menu_active=false">
                                <i class="b-avatar-menu__item-icon">
                                    <img class="mw-100 h-75" ng-src="{{widget.images.icon_profile}}">
                                </i>
                                <span ng-bind="widget.texts.menu_my_profile"></span>
                            </a>
                            <a href="#" class="b-avatar-menu__item d-flex align-items-center font-weight-light text-dark py-3 pl-4 pr-5"
                               ng-href="{{widget.options.logout_link}}">
                                <i class="b-avatar-menu__item-icon">
                                    <img class="mw-100 h-75" ng-src="{{widget.images.icon_logout}}">
                                </i>
                                <span ng-bind="widget.texts.menu_logout"></span>
                            </a>
                        </div>
                    </div>
                </div>
                <h1 class="display-4 text-uppercase font-weight-bolder"
                    ng-bind-html="widget.texts.header|to_trusted"></h1>
                <p class="my-4 font-weight-light" ng-bind-html="widget.texts.sub_header|to_trusted"></p>
                <a class="btn btn-md btn-primary text-uppercase px-3 py-2 font-weight-bold" href="#" role="button"
                   target="_blank"
                   ng-click="$event.preventDefault();$root.$broadcast('text:state', true)"
                   ng-bind="widget.texts.button_text"></a>
            </div>
        </div>
    </div>

    <magic-modal ng-show="!$parent.show_profile" show="$parent.$parent.show_info">
        <magic-modal-title>
            <div class="b-avatar">
                <img ng-src="{{user().user.avatar['250x250']|sailplay_pic}}" class="rounded-circle">
            </div>
            <span class="b-name d-block my-5 text-black" ng-bind="user().user.name"></span>
        </magic-modal-title>
        <magic-modal-body>

            <div ng-show="user().user.email" class="b-info mb-5 pt-3 d-flex align-items-center flex-column flex-column-light">
                <img ng-src="{{widget.images.icon_email}}">
                <span class="mt-2" ng-bind="user().user.email"></span>
            </div>

            <div ng-show="user().user.phone" class="b-info mb-5 d-flex align-items-center flex-column flex-column-light">
                <img ng-src="{{widget.images.icon_phone}}">
                <span class="mt-2" ng-bind="user().user.phone|tel"></span>
            </div>

            <div ng-show="user().user.birth_date" class="b-info mb-5 d-flex align-items-center flex-column flex-column-light">
                <img ng-src="{{widget.images.icon_bday}}">
                <span class="mt-2" ng-bind="user().user.birth_date|date:'d MMMM yyyy'"></span>
            </div>

            <div class="b-info d-flex align-items-center justify-content-center">
                <a class="btn btn-md btn-primary text-uppercase px-3 py-2 font-weight-bold" href="#" role="button"
                   ng-click="$event.preventDefault();$root.$broadcast('profile:state', true)"
                   ng-bind="widget.texts.edit_profile"></a>
            </div>


        </magic-modal-body>
    </magic-modal>

    <magic-modal on-close="revert_profile_form" show="$parent.$parent.show_profile" prevent-close="lock_profile">
        <magic-modal-title ng-bind-html="widget.texts.modals.profile.title|to_trusted"></magic-modal-title>
        <magic-modal-body>

            <form name="profile_form" class="spm_profile-form"
                  ng-submit="sailplay.fill_profile.submit(profile_form, onSaveProfile);">

                <div class="spm_form_field" ng-repeat="field in sailplay.fill_profile.form.fields"
                     ng-switch="field.input">

                    <div ng-switch-when="text">
                        <input class="spm_form_input" type="text" placeholder="{{ field.placeholder }}"
                               ng-model="field.value" ng-required="field.required">
                        <label class="spm_form_label type_absolute" ng-bind="field.label"></label>
                    </div>

                    <div ng-switch-when="date">
                        <label class="spm_form_label " ng-bind="field.label"></label>
                        <date-picker ng-model="field.value" ng-required="field.required"></date-picker>
                    </div>

                    <div ng-switch-when="phone">
                        <input class="spm_form_input" type="text"
                               ui-mask="{{ field.placeholder }}" ng-model="field.value"
                               ng-required="field.required">
                        <label class="spm_form_label type_absolute" ng-bind="field.label"></label>
                    </div>

                    <div ng-switch-when="email">
                        <input class="spm_form_input" type="email" placeholder="{{ field.placeholder }}"
                               ng-model="field.value" ng-required="field.required">
                        <label class="spm_form_label type_absolute">{{ field.label }}</label>
                    </div>

                    <div ng-switch-when="select">
                        <select class="spm_form_select" ng-model="field.value"
                                ng-options="item.value as item.text for item in field.data"></select>
                        <label class="spm_form_label type_absolute" ng-bind="field.label"></label>
                    </div>

                </div>

                <div class="spm_form_buttons">
                    <button class="spm_btn theme_1 type_big type_cancel font-weight-bold" ng-click="$parent.close()"
                            ng-bind="widget.texts.modals.profile.cancel"></button>
                    <input type="submit" class="spm_btn theme_1 type_filled type_big font-weight-bold"
                           ng-value="widget.texts.modals.profile.save"/>
                </div>

            </form>

        </magic-modal-body>
    </magic-modal>

    <magic-modal show="$parent.$parent.show_history">
        <magic-modal-title>
            <span class="d-block text-left" ng-bind="widget.texts.modals.history.title"></span>
        </magic-modal-title>
        <magic-modal-body>
            <div sailplay-history>

                <table class="spm_profile-history" ng-show="history().length">
                    <tbody>
                    <tr dir-paginate="item in history() | itemsPerPage:5" pagination-id="history_pages">
                        <td class="type_lighter" ng-bind="item.action_date | date:'d MMM yyyy'"></td>
                        <td>
                            <div ng-bind="item|history_item"></div>
                        </td>
                        <td></td>
                        <!--<td ng-class="{type_positive:item.points_delta>0, type_negative:item.points_delta<0}"-->
                            <!--ng-bind="item.points_delta?(item.points_delta|number):''"></td>-->
                    </tr>
                    </tbody>
                </table>

                <dir-pagination-controls max-size="7" direction-links="false" pagination-id="history_pages"
                                         template-url="magic.pagination"
                                         auto-hide="true"></dir-pagination-controls>

                <div ng-hide="history().length" ng-bind="widget.texts.modals.history.empty"></div>

            </div>
        </magic-modal-body>
    </magic-modal>

    <magic-modal show="$parent.$parent.show_text">
        <magic-modal-title ng-bind-html="widget.texts.modals.text.title|to_trusted"></magic-modal-title>
        <magic-modal-body ng-bind-html="widget.texts.modals.text.body|to_trusted"></magic-modal-body>
    </magic-modal>

</section>